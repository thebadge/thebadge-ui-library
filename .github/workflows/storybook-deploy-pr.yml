# Workflow name
name: 'Chromatic Deployment - PR'

# Event for the workflow
# Triggers the workflow on push or pull request events but only for the development branch
on:
  pull_request:
    types: [opened, reopened, ready_for_review, synchronize]
    branches:
      - main

# List of jobs
jobs:
  test:
    # Operating System
    runs-on: ubuntu-latest
    # Job steps
    steps:
      - uses: actions/checkout@v1
      - run: yarn
        #ðŸ‘‡ Adds Chromatic as a step in the workflow
      - name: Publish to Chromatic
        id: publish
        uses: chromaui/action@v1
        # Chromatic GitHub Action options
        with:
          # ðŸ‘‡ Chromatic projectToken, refer to the manage page to obtain it.
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
      - name: Comment PR with deployment url
          uses: mshick/add-pr-comment@v1
          with:
            message: |
              * [PR Version](${{ env.REVIEW_FEATURE_URL }})
            repo-token: ${{ secrets.GITHUB_TOKEN }}
            repo-token-user-login: 'github-actions[bot]'
          env:
            REVIEW_FEATURE_URL: ${{ publish.outputs.storybookUrl }}
